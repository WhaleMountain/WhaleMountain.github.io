<!doctype html><html><head><meta charset=utf-8><title>Whale Mountain
</title><meta name=viewport id=viewport content="width=device-width,initial-scale=1"><link rel=icon type=image/x-icon href=https://whalem.net/images/wm.png><link rel=apple-touch-icon href=https://whalem.net/images/wm.png><link rel=stylesheet href=https://whalem.net/scss/style.css><link rel=stylesheet href=https://whalem.net/scss/monokai-sublime.min.css><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js></script><link rel=stylesheet href=https://whalem.net/scss/highlight.css><link rel=stylesheet href=https://whalem.net/scss/custom.css><meta name=generator content="Hugo 0.145.0"></head><body><div class=header><div class=site-logo__wrap><div id=site-button><div></div></div><div class=site-logo><a href=https://whalem.net/><img src=https://whalem.net/images/wm.png></a></div></div><div class='site-nav u-font' id=nav-bar><div class=site-nav__wrap><a class=site-nav__el href=/>HOME</a></div><div class=site-nav__wrap><a class=site-nav__el href=/post>POST</a></div><div class=site-nav__wrap><a class=site-nav__el href=/about>ABOUT</a></div><div class=site-nav__wrap><a class=site-nav__el href=/tags/>TAGS</a></div></div></div><div class=main><div class=main-content><div class=main-content__date><h4 id=date>Published on 2024.08.12 19:38</h4><h4 id=date>Edited on 2024.08.12 20:50</h4></div><div class=main-content__title><h1 id=title>Highlight.jsのアップデート</h1></div><div class=main-content__article><article id=content><p>下記コミットの内容についての記事です。</p><ul><li><a href=https://github.com/WhaleMountain/whalem/commit/915fa2653faf452a911f054bc17ed8cbd372cdff>update submodule and config.toml</a></li><li><a href=https://github.com/WhaleMountain/hugo-theme-yuki/commit/e00767e95db6532b5cb5892f8627795c694c582d>update highlightjs</a></li></ul><h3 id=リンクの変更>リンクの変更</h3><p>テーマで使用されていた <a href=https://highlightjs.org/>Highlight.js</a> のバージョンが <code>v9.13.1</code> でした。<br>脆弱性の報告もあるのでバージョンを上げようと思いました。</p><ul><li>参考: <a href=https://security.snyk.io/package/npm/highlight.js/9.13.1>highlight.js@9.13.1 vulnerabilities</a></li></ul><p>公式サイトからJSファイルをダウンロードしてファイルを更新してもいいけど、バージョンアップがしやすいようにCDNを利用します。</p><pre><code class=language-diff>- &lt;script src=&quot;{{ &quot;js/highlight.min.js&quot; | absURL }}&quot;&gt;&lt;/script&gt;
+ &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/highlight.min.js&quot;&gt;&lt;/script&gt;
</code></pre><p>あとは <code>initHighlightingOnLoad</code> が非推奨になっているので、ドキュメント通りに変更する。</p><ul><li><a href="https://highlightjs.readthedocs.io/en/latest/api.html?highlight=initHighlightingOnLoad#inithighlightingonload">Deprecated API</a></li></ul><pre><code class=language-diff>- &lt;script&gt;hljs.initHighlightingOnLoad();&lt;/script&gt;
+ &lt;script&gt;hljs.highlightAll();&lt;/script&gt;
</code></pre><h3 id=エラーの修正>エラーの修正</h3><p>これで終わりかなと思ったらコンソールに下記 Warning が。。</p><pre><code class=language-console>One of your code blocks includes unescaped HTML. This is a potentially serious security risk.
https://github.com/highlightjs/highlight.js/wiki/security
The element with unescaped HTML:
...
</code></pre><p>調べてたら強調されているコードを再強調すると Warning が表示されるらしい。</p><ul><li>参考: <a href=https://github.com/highlightjs/highlight.js/issues/3761>Repeated highlighting of already highlighted code causes &ldquo;<em>One of your code blocks includes unescaped HTML. This is a potentially serious security risk.</em>&rdquo;</a></li></ul><p>実際にコンソールで <code>hljs.highlightAll();</code> を叩いてみるとページ表示時と同じ箇所で Warning が表示されました。<br>色々試して Highlight.js の読み込みを削除してもシンタックスハイライトが適用されていました。
Hugo のドキュメントを見てみると Hugo 側で <a href=https://gohugo.io/content-management/syntax-highlighting/#highlight-shortcode>Syntax highlighting</a> 機能を持っているようでした。</p><p>Hugo 側でハイライトを付けた後に Highlight.js でハイライト付けようとしているから Warning が表示されるのかな。多分。<br>あとはドキュメントを参考に Hugo 側のシンタックスハイライトをオフにしてみます。</p><ul><li>参考: <a href=https://gohugo.io/getting-started/configuration-markup/#highlight>Configure markup</a></li></ul><pre><code class=language-toml>[markup]
  [markup.highlight]
    codeFences = false
</code></pre><p>設定してコンソールをみると Warning は表示されませんでした。めでたしめでたし。</p><h3 id=reference>Reference</h3><ul><li><a href=https://github.com/highlightjs/highlight.js/issues/3761>Repeated highlighting of already highlighted code causes &ldquo;<em>One of your code blocks includes unescaped HTML. This is a potentially serious security risk.</em>&rdquo;</a></li></ul></article></div><div class="main-content__tags u-font"><span><a href=https://whalem.net/tags/2024-08>2024-08</a></span>
<span><a href=https://whalem.net/tags/highlight.js>Highlight.js</a></span>
<span><a href=https://whalem.net/tags/hugo>Hugo</a></span></div></div><div class=main-profile><div class=main-profile__avatar><img src="https://avatars.githubusercontent.com/u/33239408?s=460&amp;u=e42f33454abd96a2add42e436aa64421a0591d00&amp;v=4"></div><div class=main-profile__body><div class=main-profile__author><span>Whale Mountain</span></div><div class=main-profile__description><p>Tofu on fire :)</p></div></div></div><div class=main-line></div><div class=main-pn><a class=previous href=https://whalem.net/post/2024-08/my-dotfiles/><div class=pn-dec></div><div class=pn-els><div class=pn-el__1>2024.08.06 22:18</div><div class=pn-el__2>こだわりのないdotfiles</div></div></a><a class=next href=https://whalem.net/post/2024-08/raspi-init-setup/><div class=pn-dec></div><div class=pn-els><div class=pn-el__1>2024.08.17 16:07</div><div class=pn-el__2>Raspberry Piの初期設定</div></div></a></div></div><div class=footer><div class=copyright-wrap><p class="copyright u-font">© 2021 Whale Mountain. Theme yuki. Powered by Hugo.</p></div></div></body><script src=https://whalem.net/js/page.js></script><script>hljs.highlightAll()</script>